---
import Layout from "@/layouts/Layout.astro";
import Columns from "@/components/ui/Columns.astro";
import ContentCard from "@/components/ContentCard.astro";
import { getCollection, render } from "astro:content";
import { sortByDate, formatDate, getContentUrl } from "@/lib/content/utils";

const allPosts = await getCollection("blog");
const posts = sortByDate(allPosts);

// Pre-render to get reading time from remark plugin
const readingTimes = new Map<string, string>();
await Promise.all(
	posts.map(async (post) => {
		const { remarkPluginFrontmatter } = await render(post);
		readingTimes.set(post.id, remarkPluginFrontmatter.readingTime?.text ?? "");
	})
);
---

<Layout title="Blog" ogImage="social-preview.png" description="My space on the internet. I'm happy you're here ^^">
	<h2>I'm happy you're here ^^</h2>
	<ul class="mb-6">
		<li>Your mind is for having ideas, not holding them.</li>
		<li>A place to capture, organize, distill and express what I consume.</li>
	</ul>
	<Columns columns={1}>
		{
			posts.map((post) => (
				<ContentCard
					name={post.data.title}
					url={getContentUrl(post.id, "/blog")}
					image={post.data.image.url}
					description={post.data.description}
					date={formatDate(post.data.pubDate, "long")}
					tags={post.data.tags}
					readingTime={readingTimes.get(post.id)}
				/>
			))
		}
	</Columns>
</Layout>
