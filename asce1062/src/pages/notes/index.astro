---
import Layout from "@/layouts/Layout.astro";
import Columns from "@/components/ui/Columns.astro";
import ContentCard from "@/components/ContentCard.astro";
import { getCollection, render } from "astro:content";
import { sortByDate, getContentUrl, formatDate } from "@/lib/content/utils";
import { NOTEBOOK } from "@/config/site-config";

const allNotes = await getCollection("notes");
const notes = sortByDate(allNotes);

const readingTimes = new Map<string, string>();
await Promise.all(
	notes.map(async (note) => {
		const { remarkPluginFrontmatter } = await render(note);
		readingTimes.set(note.id, remarkPluginFrontmatter.readingTime?.text ?? "");
	})
);
---

<Layout title="Notebook" ogImage="social-preview.png" description={NOTEBOOK.description}>
	<h2>Notebook</h2>
	<p>{NOTEBOOK.description}</p>
	<Columns columns={1}>
		{
			notes.map((note) => (
				<ContentCard
					name={note.data.title}
					url={getContentUrl(note.id, "/notes")}
					description={note.data.description}
					date={formatDate(note.data.pubDate, "long")}
					tags={note.data.tags}
					readingTime={readingTimes.get(note.id)}
				/>
			))
		}
	</Columns>
</Layout>
