---

---

<button
	id="theme-toggle-btn"
	class="float-right h-7 w-7 md:h-8 md:w-8 rounded-md transition-all duration-100"
	aria-label="Switch page theme">
	<i id="toggleIcon"></i>
</button>

<script>
	import { initThemeSwitcher, handleThemeToggle } from "@/scripts/themeManager";

	// Store the click handler so we can remove it later
	let themeToggleHandler: (() => void) | null = null;

	function setupThemeToggle() {
		initThemeSwitcher();

		const themeButton = document.getElementById("theme-toggle-btn");
		if (!themeButton) return;

		// Remove old event listener if it exists
		if (themeToggleHandler) {
			themeButton.removeEventListener("click", themeToggleHandler);
		}

		// Create new handler
		themeToggleHandler = () => {
			handleThemeToggle();
		};

		// Add new event listener
		themeButton.addEventListener("click", themeToggleHandler);
	}

	// Initialize on first load
	if (document.readyState === "loading") {
		document.addEventListener("DOMContentLoaded", setupThemeToggle);
	} else {
		// DOM already loaded, run immediately
		setupThemeToggle();
	}

	// Reinitialize after view transitions
	document.addEventListener("astro:page-load", setupThemeToggle);
</script>
