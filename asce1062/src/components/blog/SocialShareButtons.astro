---
/**
 * Provides sharing functionality for blog posts across multiple platforms
 */

interface Props {
	title: string;
	url: string;
}

const { title, url } = Astro.props;
const encodedTitle = encodeURIComponent(title);
const encodedUrl = encodeURIComponent(url);

const shareLinks = [
	{
		platform: "WhatsApp",
		url: `https://wa.me/?text=${encodedTitle} ${encodedUrl}`,
		icon: "icon-whatsapp",
		label: "Share on WhatsApp",
	},
	{
		platform: "Facebook",
		url: `https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}`,
		icon: "icon-facebook",
		label: "Share on Facebook",
	},
	{
		platform: "X/Twitter",
		url: `https://x.com/intent/post?text=${encodedTitle}&url=${encodedUrl}`,
		icon: "icon-twitter-x",
		label: "Share on X/Twitter",
	},
	{
		platform: "Telegram",
		url: `https://t.me/share/url?url=${encodedUrl}&text=${encodedTitle}`,
		icon: "icon-telegram",
		label: "Share on Telegram",
	},
	{
		platform: "Pinterest",
		url: `https://pinterest.com/pin/create/button/?url=${encodedUrl}&description=${encodedTitle}`,
		icon: "icon-pinterest",
		label: "Share on Pinterest",
	},
	{
		platform: "Email",
		url: `mailto:?subject=${encodedTitle}&body=${encodedUrl}`,
		icon: "icon-envelope-at",
		label: "Share via Email",
	},
];
---

<div class="flex flex-col flex-wrap items-center justify-center gap-1 sm:items-start text-palette-800">
	<b class="italic">Share this post on:</b>
	<br />
	<div class="text-center">
		{
			shareLinks.map(({ url, icon, label }) => (
				<a
					href={url}
					target={label.includes("Email") ? undefined : "_blank"}
					rel={label.includes("Email") ? undefined : "noopener noreferrer"}
					class="no-underline group hover:text-accent scale-90 p-2 hover:rotate-6 sm:p-1"
					aria-label={label}>
					<i class={`${icon} text-2xl`} />
				</a>
			))
		}
		<a
			id="copy-share-link-btn"
			data-url={url}
			data-title={title}
			class="no-underline group hover:text-accent scale-90 p-2 hover:-rotate-6 sm:p-1 cursor-pointer"
			aria-label="Copy link to clipboard">
			<i class="icon-share text-2xl"></i>
		</a>
		<!-- Copy Link Notification -->
		<div id="copy-share-notification" class="share-notification hidden">
			<b class="font-retro">Link copied!</b>
			<a id="close-share-notification" class="close-btn no-underline cursor-pointer" aria-label="Close notification">
				<i class="icon-x"></i>
			</a>
		</div>
	</div>
</div>

<script>
	import { CopyToClipboard } from "@/scripts/copyToClipboard";

	const copyLinkBtn = document.getElementById("copy-share-link-btn");
	const closeNotificationBtn = document.getElementById("close-share-notification");

	const clipboard = new CopyToClipboard({
		notificationId: "copy-share-notification",
	});

	copyLinkBtn?.addEventListener("click", async () => {
		const url = copyLinkBtn.getAttribute("data-url");
		const title = copyLinkBtn.getAttribute("data-title");
		if (url && title) {
			const shareText = `${title}\n${url}`;
			await clipboard.copy(shareText);
		}
	});

	closeNotificationBtn?.addEventListener("click", () => {
		clipboard.hideNotification();
	});
</script>
